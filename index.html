<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="upgrade-insecure-requests"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Roka News</title>
    <link rel="stylesheet" href="css/index.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        // Get the news data dynamically
        const mainNews = document.querySelector(".main_news");

        const apiUrl =
          "http://olti-news.eu-central-1.elasticbeanstalk.com/category/";

        const categories = [
          "us",
          "world",
          "politics",
          "business",
          "opinions",
          "health",
          "entertainment",
          "style",
          "travel",
          "sports",
        ];

        async function fetchCategoryData(category) {
          try {
            const response = await fetch(apiUrl + category);
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            const categoryData = await response.json();
            return categoryData;
          } catch (error) {
            console.error("Error fetching category data:", error);
            return [];
          }
        }

        for (const category of categories) {
          const categoryData = await fetchCategoryData(category);

          const section = document.createElement("section");
          section.id = category;
          const h3 = document.createElement("h3");
          h3.textContent = category.toUpperCase();
          section.appendChild(h3);

          const newsContainer = document.createElement("div");
          newsContainer.classList.add("news_container");

          for (let i = 0; i < Math.min(4, categoryData.length); i++) {
            const article = categoryData[i];
            console.log(article);
            const a = document.createElement("a");
            a.href = `news.html?id=${article.url}&desc=${article.description}&image=${article.image}&title=${article.title}`;
            a.style.textDecoration = "none";
            a.style.color = "inherit";
            const image = document.createElement("img");
            image.src = article.image;
            a.append(image);

            const h2 = document.createElement("h2");
            h2.textContent = article.title;
            a.appendChild(h2);

            const pDesc = document.createElement("p");
            pDesc.textContent = article.description;
            a.appendChild(pDesc);

            const pTime = document.createElement("p");
            pTime.textContent = article.timestamp;
            a.appendChild(pTime);

            newsContainer.appendChild(a);
          }

          section.appendChild(newsContainer);
          mainNews.appendChild(section);
        }
      });
    </script>
  </head>
  <body>
    <header>
      <div class="navigation_container">
        <div class="today_container">
          <img src="./assets/globe.png" alt="globe" />
          <p class="today">Tuesday, October 31, 2023</p>
        </div>
        <h1 class="title"><a href="index.html">R<span>o</span>ka News</a></h1>
        <nav>
          <ul>
            <li class="search_bar">
              <input type="text" />
              <img src="./assets/search.png" alt="search-icon" />
            </li>
            <li><a href="index.html">Latest News</a></li>
            <li><a href="finance.html">Finance News</a></li>
            <li><a href="signin.html">Log In</a></li>
          </ul>
        </nav>
      </div>
    </header>
    <main>
      <a class="back_top" href="#">
        <p>Back to top</p>
        <svg
          width="30"
          height="30"
          viewBox="0 0 30 30"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <circle cx="15" cy="15" r="15" fill="#FF5C00" />
          <path
            d="M21.3 17.7L15 11.4L8.7 17.7"
            stroke="white"
            stroke-linejoin="bevel"
          />
        </svg>
      </a>
      <div class="section_container">
        <ul>
          <li><a href="#us">US</a></li>
          <li><a href="#world">World</a></li>
          <li><a href="#politics">Politics</a></li>
          <li><a href="#business">Business</a></li>
          <li><a href="#opinions">Opinions</a></li>
          <li><a href="#health">Health</a></li>
          <li><a href="#entertainment">Entertainment</a></li>
          <li><a href="#style">Style</a></li>
          <li><a href="#travel">Travel</a></li>
          <li><a href="#sports">Sports</a></li>
        </ul>
      </div>
      <div class="main_content">
        <div class="main_news"></div>
        <div class="finance_data"></div>
      </div>
    </main>
    <footer>
      <div>
        <a href="mailto:olti@roka.dev" target="_blank">Contact Us</a>
        <p>&copy; 2023 Roka News</p>
      </div>
    </footer>

    <script src="js/scripts.js"></script>
  </body>
</html>
