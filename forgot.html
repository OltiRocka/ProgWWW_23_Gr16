<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="css/all.css" />
    <link rel="stylesheet" href="css/account.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <header>
      <div class="navigation_container">
        <div class="today_container">
          <img src="./assets/globe.png" alt="globe" />
          <p id="today"></p>
        </div>
        <h1 class="title"><a href="index.html">R<span>o</span>ka News</a></h1>
        <nav>
          <ul>
            <img
              src="./assets/search.png"
              alt="phone-search"
              id="phone-search"
              onclick="searchOnPhone()"
            />
            <li id="search_bar">
              <form action="/search.html" id="searchForm" method="get">
                <input type="text" id="searchInput" name="q" required />
                <button type="submit" id="searchButton">
                  <img src="./assets/search.png" alt="search-icon" />
                </button>
              </form>
            </li>
            <li><a href="index.html">Latest News</a></li>
            <li>
              <a href="livetv.html"
                ><div class="circle"></div>
                Live TV</a
              >
            </li>

            <li><a id="account" href="signin.html">Log In</a></li>
          </ul>
        </nav>
      </div>
    </header>
    <main>
      <div id="form-container">
        <h2>Forgot Password</h2>
        <form id="forgot-form">
          <div>
            <label for="email">Email:</label>
            <input type="email" id="email" required />
          </div>

          <button type="submit">Send Email</button>
        </form>
        <p id="warning"></p>
        <div class="already_container">
          <a href="signin.html">Sign In</a>
          <a href="signup.html">Sign Up</a>
        </div>
      </div>
    </main>
    <footer id="footer-content">
      <div>
        <address style="text-align: left">
          Made by <a href="mailto:olti@roka.dev">Olti Roka</a>.<br />
          Visit me at:
          <a href="https://roka.dev">Roka.Dev</a><br />
        </address>
        <p>&copy; 2023 Roka News</p>
      </div>
    </footer>
  </body>
  <script type="module">
    import { forgotPassword, auth } from "./js/modules/firebase.js"; // adjust the path as necessary
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.querySelector("#forgot-form");
      const account = document.querySelector("#account");

      onAuthStateChanged(auth, (user) => {
        if (user) {
          account.href = "profile.html";
          account.innerText = "Profile";
          location.href = "profile.html";
        } else {
          console.log("Not Logged In");
        }
      });
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.querySelector("#email").value;

        try {
          const user = await forgotPassword(email);
        } catch (error) {
          console.log(error);
          document.getElementById("warning").innerText = getWarningMessage(
            error.message
          );
        }
      });
      document.getElementById("loading-screen").style.display = "none";
      document.getElementById("main-content").style.display = "block";
      document.getElementById("footer-content").style.display = "block";
    });
  </script>
  <script>
    Object.defineProperty(String.prototype, "capitalize", {
      value: function () {
        return this.charAt(0).toUpperCase() + this.slice(1);
      },
      enumerable: false,
    });
    function getWarningMessage(text) {
      return text.split("/")[1].split(")")[0].replace(/-/g, " ").capitalize();
    }
  </script>
</html>
